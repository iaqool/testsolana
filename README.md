
Небольшой Anchor‑проект (папка `mytoken/`), где нужно было показать работу трёх инструкций программы токена:

- `create_token_account()` — создать associated token account (ATA)
- `mint_tokens()` — наминтить токены в ATA
- `transfer_tokens()` — перевести часть токенов другому пользователю
- `burn_tokens()` — сжечь часть токенов и уменьшить total supply

Все три сценария покрыты тестами и проходят.

Основной тестовый файл: `mytoken/tests/token_program.ts` (плюс простой sanity‑тест в `tests/mytoken.ts`).

## Как это устроено

1. Программа на Rust содержит инструкции, но создание самого mint в тестах я упростил и делаю через JS (`createMint` из `@solana/spl-token`), чтобы не биться с обновлённым SPL v7 внутри on-chain кода.
2. Инструкция `create_token_account` дергает associated token program для создания ATA.
3. `mint_tokens`, `transfer_tokens` и `burn_tokens` делают CPI вызовы SPL Token.
4. Тесты не зависят от внешних env: если нет `ANCHOR_PROVIDER_URL`, берём `http://127.0.0.1:8899`.
5. Добавлен airdrop тем, кто будет что‑то подписывать / получать, чтобы не падать по недостатку лампортов.


## Запуск локально

```bash
# (Один раз) установить Solana CLI и Anchor (версии у меня были: solana 1.18.26, anchor 0.31.1)

cd mytoken
anchor build   # если правил Rust

# Отдельно можно поднять валидатор и загрузить программу:
solana-test-validator --reset --bpf-program EYfHSdmUTkcXEt2rsUUdW16C9taGPR8sXjMsQqV4F5pZ target/verifiable/mytoken.so &
sleep 4

# Настроить ключ (если не настроен)
solana-keygen new --no-passphrase -s -o ~/.config/solana/id.json
solana config set --url localhost

# JS зависимости (из корня репо или из mytoken — где лежит package.json)
yarn install

# Запуск тестов
yarn test
```

Альтернатива через Anchor (но мы уже собрали):

```bash
anchor test --skip-build
```

Если ловите `Unable to get latest blockhash` — валидатор не успел, просто повторите через пару секунд. В `Anchor.toml` добавлен `startup_wait`.

## Что конкретно проверяется

| Инструкция | Операция | Ожидаемый результат |
|------------|----------|---------------------|
| create_token_account | Создание/нахождение ATA | Адрес = ATA(payer,mint), владелец совпадает |
| mint_tokens | Mint 500 токенов | Баланс ATA == 500, supply == 500 |
| transfer_tokens | Перевод 200 второму кошельку | Балансы: отправитель 300 / получатель 200 |
| burn_tokens | Сжигание 50 токенов у отправителя | Баланс отправителя 250, total supply 450 |

Выводятся сигнатуры транзакций для наглядности.


- Негативных сценариев нет (могли бы тестить отказ при чужом authority).
- В типах местами `any`, чтобы не тратить время на генерацию TS типов из IDL.
- Не выносил вспомогательные хелперы (airdrop, getOrCreateAta) в отдельный файл

## FAQ

**Почему не тестируем `create_token`?**  
Версия SPL обновилась, быстрее было вынести mint в JS и идти дальше.


**Почему баланс именно 500 / 200 / 50 (burn)?**  
Просто удобные круглые числа для проверки арифметики (500 -> -200 -> 300 -> -50 -> 250). Можно менять — тогда поправьте ожидания в тесте.

## Лицензия / Авторство

Учебный код без гарантий. Берите что нужно. Если что-то не запускается — проверьте, что валидатор жив и сиды (ATA) совпадают.

---
Если понадобится вернуть полное создание mint внутри программы — можно оформить как отдельную задачу и дописать позднее.
